<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="bower_components/Nwagon/Nwagon.css" type="text/css">
    <link rel="stylesheet" href="stylesheets/style.css">
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="bower_components/angular/angular.min.js"></script>
    <script src="bower_components/Nwagon/Nwagon.js"></script>
</head>
<body ng-cloak ng-app="sentimeter" ng-controller="view">
<!--FFDC74-->
<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="http://localhost:3000/home">
                <img src="image/logo.png" width="150">
            </a>
        </div>
        <div>
            <ul class="nav navbar-nav navbar-right">
            <form class="navbar-form" role="search">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search" ng-model="input"
                           ng-keyup="$event.keyCode == 13 && toggle()">

                    <div class="input-group-btn">
                        <button class="btn btn-default" ng-click="toggle()" type="submit"><i
                                    class="glyphicon glyphicon-search"></i></button>
                    </div>
                </div>
            </form>
            </ul>
        </div>
    </div>
    <div class="well well-lg vw-container-header-well" ng-hide="erroralert">
        <h4>
            <small style="color:#72848B;">총 {{model.sentiment.totalCount}}개의 글의</small>
            "{{keyword}}"에 대한 감성분석 결과입니다.
        </h4>
    </div>
    <div class="well well-lg vw-container-header-error-well" ng-show="erroralert">
        <h4>"{{keyword}}"에 대한 글이 없습니다. 다른 키워드를 입력해주세요.</h4>
    </div>
    <div class="vw-container-header-keyword">
        <h5 style="color:#72848B">많이 검색한 키워드:
            <small ng-repeat="keyword in model.search">
                <a href="{{keyword.url}}" style="font-size:12px; padding-left:1em; color:#696969">{{keyword.word}}</a>
            </small>
        </h5>
    </div>
</nav>

<div class="vw-container">
    <div class="vw-container-header">
    </div>
    <div ng-show="dataExist">
        <div class="vw-container-sentimentBar">
            <h4><span class="glyphicon glyphicon-ok"></span> 감성분석결과</h4>

            <div class="progress progress-striped">
                <div class="progress-bar progress-bar-positive progress-bar-striped" role="progressbar"
                     aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
                     style="width: {{model.sentiment.positive}}%;">
                    <span>긍정 {{model.sentiment.positive}}%</span>
                </div>
                <div class="progress-bar progress-bar-neutral progress-bar-striped" role="progressbar"
                     aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
                     style="width: {{model.sentiment.neutral}}%;">
                    <span>중립 {{model.sentiment.neutral}}%</span>
                </div>
                <div class="progress-bar progress-bar-negative progress-bar-striped" role="progressbar"
                     aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
                     style="width: {{model.sentiment.negative}}%;">
                    <span>부정 {{model.sentiment.negative}}%</span>
                </div>
            </div>
        </div>
        <div class="vw-container-analysis">
            <div class="vw-container-analysis-chart">
                <h4><span class="glyphicon glyphicon-stats"></span> 일주일 분포</h4>

                <div id="chart18"></div>
            </div>
            <div class="vw-container-analysis-word">
                <h4><span class="glyphicon glyphicon-menu-hamburger"></span> 단어</h4>
                <table class="table">
                    <thead>
                    <tr>
                        <th>단어</th>
                        <th>횟수</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="word in model.word" style="{{word.style}}">
                        <td>{{word.word}}</td>
                        <td>{{word.count}}</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="vw-container-sns">
            <h4><span class="glyphicon glyphicon-search"></span> 게시글</h4>
            <ul class="nav nav-pills category">
                <li class="active">
                    <a ng-click="selectCategory()" data-toggle="pill" href="#home">전체</a></li>
                <li ng-repeat="item in model.option.dataset.fields">
                    <a ng-click="selectCategory(item)" data-toggle="pill" href="#menu1">{{item}}</a></li>
            </ul>

            <div class="tab-content">
                <div id="home" class="tab-pane fade in active">
                    <ul class="list-group">
                        <li ng-repeat="article in model.sentiment.text" class="list-group-item">
                        <span style="color:#F17233">{{article.name}}
                            <small style="color:#72848B">@{{article.scrName}}</small>
                            <small style="color:#C6C6C6; padding-left:1em;">{{article.date}}</small></span>
                            <br>
                            <a style="color:#000000;" href="{{article.URL}}">{{article.Text}}</a>
                        </li>
                    </ul>
                </div>
                <div id="menu1" class="tab-pane fade">
                    <ul class="list-group">
                        <li ng-repeat="article in model.sentiment.text | filter:categoryFilterFn"
                            class="list-group-item">
                        <span style="color:#F17233">{{article.name}}
                            <small style="color:#72848B">@{{article.scrName}}</small>
                            <small style="color:#C6C6C6; padding-left:1em;">{{article.date}}</small></span>
                            <br>
                            <a style="color:#000000;" href="{{article.URL}}">{{article.Text}}</a>
                        </li>
                    </ul>
                </div>
                <div id="menu2" class="tab-pane fade">
                    <ul class="list-group">
                        <li ng-repeat="article in model.sentiment.text | filter:categoryFilterFn"
                            class="list-group-item">
                        <span style="color:#F17233">{{article.name}}
                            <small style="color:#72848B">@{{article.scrName}}</small>
                            <small style="color:#C6C6C6; padding-left:1em;">{{article.date}}</small></span>
                            <br>
                            <a style="color:#000000;" href="{{article.URL}}">{{article.Text}}</a>
                        </li>
                    </ul>
                </div>
                <div id="menu3" class="tab-pane fade">
                    <ul class="list-group">
                        <li ng-repeat="article in model.sentiment.text | filter:categoryFilterFn"
                            class="list-group-item">
                        <span style="color:#F17233">{{article.name}}
                            <small style="color:#72848B">@{{article.scrName}}</small>
                            <small style="color:#C6C6C6; padding-left:1em;">{{article.date}}</small></span>
                            <br>
                            <a style="color:#000000;" href="{{article.URL}}">{{article.Text}}</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    keyword = "<%= key%>"
    var sentimeter = angular.module("sentimeter", []);
    var options = {
        'legend': {
            hrefs: []
        },
        'dataset': {
            title: 'Playing time per day',
            colorset: ['#82DCF8', '#C6C6C6', "#FE9289"],
        },
        'chartDiv': 'chart18',
        'chartType': 'multi_column',
        'chartSize': {width: 640, height: 320}
    };

    sentimeter.controller("view", function ($scope, $http, $filter) {
        var selectedCategory = null;
        $scope.dataExist = false;
        $scope.erroralert = false;
        $scope.keyword = keyword;
        $scope.model = {};
        $http.get("http://localhost:3000/result/sentimentBar?keyword=" + keyword).success(function (data) {
            $scope.model.sentiment = data;
            if (data.totalCount != 0) {
                $scope.dataExist = true;
            }
            else {
                $scope.erroralert = true;
            }
        });
        $http.get("http://localhost:3000/result/chart?keyword=" + keyword).success(function (data) {
            $scope.model.option = data;
            options.legend.names = data.legend.names;
            options.dataset.values = data.dataset.values;
            options.dataset.fields = data.dataset.fields;
            options.maxValue = data.maxValue;
            options.increment = Math.ceil(data.maxValue / 12);
            Nwagon.chart(options);
        });
        $http.get("http://localhost:3000/result/wordCount?keyword=" + keyword).success(function (data) {
            $scope.model.word = $filter("limitTo")(data.splice(0), 7);
        });
        $http.get("http://localhost:3000/result/search").success(function (data) {
            $scope.model.search = $filter("limitTo")(data.splice(0), 8);
        });

        $scope.toggle = function () {
            location.href = "http://localhost:3000/view?keyword=" + $scope.input;
        };

        $scope.categoryFilterFn = function (article) {
            return selectedCategory == null || article.sentiment == selectedCategory;
        };

        $scope.selectCategory = function (newCategory) {
            selectedCategory = newCategory;
        };
    });

</script>
</body>
</html>
